<div class="min-h-screen bg-dark-950">
  <!-- Navigation -->
  <app-navbar></app-navbar>
  
  <div class="payments-container">
    <header class="payments-header">
      <div class="flex items-center space-x-4">
        <button (click)="goBack()" class="back-btn">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Back
        </button>
        <h1>My Payments</h1>
      </div>
      <div class="user-info">
        <span>Welcome, {{ user?.name }}!</span>
      </div>
    </header>

  <div class="payments-content">
    <div class="payments-section">
      <div class="section-header">
        <h2>Payment History</h2>
        <button class="btn btn-primary" (click)="showPaymentModal()">Record New Payment</button>
      </div>
      
      <div class="payments-grid" *ngIf="payments.length > 0">
        <div class="payment-card" *ngFor="let payment of payments">
          <div class="payment-header">
            <h3>${{ payment.amount }}</h3>
            <span class="payment-method">{{ getPaymentMethodLabel(payment.method) }}</span>
          </div>
          
          <div class="payment-details">
            <div class="payment-info">
              <div class="info-item">
                <span class="label">Date:</span>
                <span class="value">{{ payment.createdAt | date:'short' }}</span>
              </div>
              <div class="info-item" *ngIf="payment.userPolicyId">
                <span class="label">Policy:</span>
                <span class="value">{{ payment.userPolicyId?.policyProductId?.title || 'N/A' }}</span>
              </div>
              <div class="info-item" *ngIf="payment.reference">
                <span class="label">Reference:</span>
                <span class="value">{{ payment.reference }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="payments.length === 0 && !loading">
        <div class="empty-icon">ðŸ’³</div>
        <h3>No Payments Found</h3>
        <p>You haven't made any payments yet.</p>
        <button class="btn btn-primary" (click)="showPaymentModal()">Record First Payment</button>
      </div>

      <div class="loading-state" *ngIf="loading">
        <div class="spinner"></div>
        <p>Loading payments...</p>
      </div>
    </div>

    <div class="claims-section" *ngIf="approvedClaims.length > 0">
      <h2>Approved Claims - Ready for Payment</h2>
      
      <div class="claims-grid">
        <div class="claim-card" *ngFor="let claim of approvedClaims">
          <div class="claim-header">
            <h3>Claim #{{ claim._id.slice(-6) }}</h3>
            <span class="claim-status approved">âœ… APPROVED</span>
          </div>
          
          <div class="claim-details">
            <div class="claim-info">
              <div class="info-item">
                <span class="label">Policy:</span>
                <span class="value">{{ claim.userPolicyId?.policyProductId?.title }}</span>
              </div>
              <div class="info-item">
                <span class="label">Amount Claimed:</span>
                <span class="value">${{ claim.amountClaimed }}</span>
              </div>
              <div class="info-item">
                <span class="label">Incident Date:</span>
                <span class="value">{{ claim.incidentDate | date:'short' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Approved By:</span>
                <span class="value">{{ claim.decidedByAgentId?.name || 'Agent' }}</span>
              </div>
            </div>
          </div>
          
          <div class="claim-actions">
            <button class="btn btn-success" (click)="showPaymentModal(claim)">Make Payment</button>
          </div>
        </div>
      </div>
    </div>

    <div class="empty-claims-state" *ngIf="approvedClaims.length === 0 && !loading">
      <div class="empty-icon">ðŸ’°</div>
      <h3>No Approved Claims</h3>
      <p>You can only make payments for claims that have been approved by an agent.</p>
      <p>Submit a claim first and wait for agent approval.</p>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="modal-overlay" *ngIf="showPaymentForm" (click)="cancelPayment()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Record Payment</h3>
        <button class="close-btn" (click)="cancelPayment()">&times;</button>
      </div>
      
      <form (ngSubmit)="recordPayment()" class="payment-form">
        <div class="form-group" *ngIf="selectedClaim">
          <label>Claim Information</label>
          <div class="claim-summary">
            <p><strong>Claim #{{ selectedClaim._id.slice(-6) }}</strong></p>
            <p>Policy: {{ selectedClaim.userPolicyId?.policyProductId?.title }}</p>
            <p>Amount: ${{ selectedClaim.amountClaimed }}</p>
          </div>
        </div>
        
        <div class="form-group">
          <label for="amount">Amount ($) *</label>
          <input 
            id="amount" 
            [(ngModel)]="paymentData.amount" 
            name="amount" 
            type="number" 
            step="0.01" 
            min="0" 
            placeholder="Enter payment amount"
            required 
          />
        </div>
        
        <div class="form-group">
          <label for="method">Payment Method</label>
          <select 
            id="method" 
            [(ngModel)]="paymentData.method" 
            name="method"
          >
            <option value="SIMULATED">Simulated Payment</option>
            <option value="CARD">Credit/Debit Card</option>
            <option value="NETBANKING">Net Banking</option>
            <option value="OFFLINE">Offline Payment</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="reference">Reference Number (Optional)</label>
          <input 
            id="reference" 
            [(ngModel)]="paymentData.reference" 
            name="reference" 
            type="text" 
            placeholder="Enter reference number"
          />
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelPayment()">Cancel</button>
          <button type="submit" class="btn btn-primary">Record Payment</button>
        </div>
      </form>
    </div>
  </div>
  </div>
</div>
